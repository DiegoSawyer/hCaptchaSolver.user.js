<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hCaptcha Ai | config</title>
    <link rel="stylesheet" href="https://unpkg.com/@codolog/form@1.0.0/dist/form.min.css">
  </head>
  <body>
    <form style="margin: auto; width: 50%; padding: 10px;">
      <div>
        <label class='form'>uid</label>
        <input type='text' name='uid' class='form'>
      </div>
      <div>
        <label class='form'>apikey</label>
        <input type='text' name='apikey' class='form'>
      </div>
      <input type='checkbox' name='isinstalled' hidden>
      <button type='submit' class='form'>Save</button>
    </form>
    <script>
    const broadcastChannel = new BroadcastChannel('nocaptcha'),
          form = document.forms[0];

    broadcastChannel.addEventListener('message', function({data, origin}) {
        console.log('Got message', data, origin);
        if (origin != 'https://diegosawyer.github.io' || origin != 'https://nocaptchaai.github.io') return;
        form.uid.value = data.uid;
        form.apikey.value = data.apikey;
        form.isinstalled.checked = true;
    });

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (!e.target.isinstalled.checked) {
            return alert('Only works when userscript is installed\nhttps://github.com/noCaptchaAi/hCaptchaSolver.user.js')
        }
        broadcastChannel.postMessage({ uid: e.target.uid.value, apikey: e.target.apikey.value })
    })
    </script>
  </body>
</html>
