<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hCaptcha Ai | config</title>
    <link rel="stylesheet" href="https://unpkg.com/@codolog/form@1.0.0/dist/form.min.css">
  </head>
  <body>
    <form style="margin: auto; width: 50%; padding: 10px;">
      <div>
        <label class='form'>uid</label>
        <input type='text' name='uid' class='form'>
      </div>
      <div>
        <label class='form'>apikey</label>
        <input type='text' name='apikey' class='form'>
      </div>
      <div>
        <label class='form'>slow internet connection</label>
        <input type='checkbox' name='internet'>
      </div>
      <input type='checkbox' name='isinstalled' hidden>
      <button type='submit' class='form'>Save</button>
    </form>
    <button onclick="account()">account details</button>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
    const broadcastChannel = new BroadcastChannel('nocaptcha'),
          searchParams = new URLSearchParams(location.search),
          form = document.forms[0];
    
    if (searchParams.get('msg')) {
        Swal.fire(JSON.stringify(searchParams.get('msg')))
    }
      
    function account() {
      
            fetch('https://free.nocaptchaai.com/api/account/balance', {
            headers: {
              'Content-Type': 'application/json',
               'uid': form.uid.value,
            'apikey': form.apikey.value
        },
    }).then(r => r.json()).then(d => alert(JSON.stringify(d)));
}
      
    broadcastChannel.addEventListener('message', function({data, origin}) {
        console.log('Got message', data, origin);
        //if (origin != 'https://nocaptchaai.com') return;
        form.uid.value = data.uid;
        form.apikey.value = data.apikey;
        form.internet.checked = data.internet
        form.isinstalled.checked = true;
    });
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const { isinstalled, uid, apikey, internet } = e.target;
        console.log(isinstalled.checked)
        if (!isinstalled.checked) {
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'It looks like you haven\'t installed the userscript',
                footer: '<a href="https://github.com/noCaptchaAi/hCaptchaSolver.user.js/raw/main/hCaptchaSolver.user.js" title="hCaptchaSolver.user.js">click here to install the userscript</a>'
             })
             return;
            //return alert('Only works when userscript is installed\n')
        }
        broadcastChannel.postMessage({ uid: uid.value, apikey: apikey.value, internet: internet.checked })
    })
    </script>
  </body>
</html>
